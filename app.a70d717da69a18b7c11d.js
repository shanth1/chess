(()=>{"use strict";var e={972:(e,t,n)=>{n.r(t),n.d(t,{peerConfiguration:()=>o});const o={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"},{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.nextcloud.com:443"},{urls:"stun:numb.viagenie.ca"},{urls:"stun:stun.voip.blackberry.com:3478"},{urls:"stun:stun.voipbuster.com"},{urls:"stun:stun.voxgratia.org"}]}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._element=document.createElement(e);for(const[e,n]of Object.entries(t))this._element.setAttribute(e,n)}get element(){return this._element}subscribe(e,t){e.subscribe(t),t()}},t=class extends e{constructor(e){super("div"),this._element.innerText=e,this._element.classList.add("header")}updateText(e){this._element.innerText=e}},o=class extends e{constructor(e,t){super("button"),this._element.innerText=e,this._element.classList.add("button"),this._element.onclick=t}},s=class extends e{constructor(){super("input"),this._element.classList.add("X6UxfUUG")}},a=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"page";!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&console.log("url routing is not available now"),this.pageId=e,window.addEventListener("hashchange",(e=>{this._resolve()})),window.addEventListener("DOMContentLoaded",(()=>{this._resolve()}))}initRoutes(e){this._routes=e}initPageContainer(e){this._pageContainer=e,this._pageContainer.id="page-container"}_activeClassResolver(e,t){window.addEventListener(e,(()=>{""===location.hash?t("#"):t(location.hash)}))}updateActiveClass(e){this._activeClassResolver("hashchange",e),this._activeClassResolver("DOMContentLoaded",e)}navigate(e){location.hash=e}isActive(e){return!location.hash&&"#"===e||location.hash===e}_updatePage(e){this._pageContainer.innerHTML="",this._pageContainer.appendChild(e)}_resolve(){if(""===location.hash){const e=this._routes["/"];return void(e&&this._updatePage(e()))}const e=this._routes[location.hash.replace("#","/")];e?this._updatePage(e()):this._pageContainer.innerHTML="404 | Not Found"}},{peerConfiguration:i}=n(972),r=new class{constructor(){this.peer=new RTCPeerConnection(i),this.peer.onconnectionstatechange=e=>{console.log("state changed:",this.peer.iceConnectionState,e)},this.peer.onicecandidateerror=e=>{console.log("ice error",e)},this.dataChannel=null}getLocalDescription(){return JSON.stringify(this.peer.localDescription)}onIceCandidate(e){this.peer.onicecandidate=t=>{console.log("Новый ICE кандидат: ",t.candidate),e()}}setRemoteDescription(e){this.peer.setRemoteDescription(JSON.parse(e))}async createOffer(){const e=await this.peer.createOffer();this.peer.setLocalDescription(e)}async createAnswer(){const e=await this.peer.createAnswer();this.peer.setLocalDescription(e)}onOpen(e,t){switch(e){case"alice":this.peer.ondatachannel=e=>{console.log("on data channel",e),this.dataChannel=e.channel,this.dataChannel.onopen=t};break;case"bob":this.dataChannel=this.peer.createDataChannel("channel-name"),this.dataChannel.onopen=t;break;default:console.error("unknown role")}}},c=function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const s=new e("div").element;s.classList.add("j2362cLf");const a=new t(n);return s.appendChild(a.element),o.forEach((e=>s.appendChild(e))),s},l=e=>{const t=document.createElement("div");return t.innerText=`[${(new Date).getHours()}:${(new Date).getMinutes()}]: ${e}`,t.style.fontSize="24px",t};window.addEventListener("load",(()=>{(async()=>{if(navigator.serviceWorker)try{const e=await navigator.serviceWorker.register("./sw.js");console.log("SW register success",e)}catch(e){console.error("SW register failed:",e)}})()}));const d=document.getElementById("root");a.initPageContainer(d),a.initRoutes({"/":()=>{const e=document.createElement("div"),t=new o("p2p",(()=>{a.navigate("connect")})).element,n=new o("Engine").element;n.disabled=!0;const s=new o("Offline").element;s.disabled=!0;const i=[t,s,n];return e.appendChild(c("Menu",i)),e},"/alice":()=>{const e=document.createElement("div");e.style.padding="20px";const t=(()=>{const e=document.createElement("div");return e.style.padding="8px",e.style.fontSize="22px",e.innerText="Статус: ожидаем offer",e})();r.onIceCandidate=()=>{t.innerText="Статус: создан answer"};const n=new o("Paste",(()=>{navigator.clipboard.readText().then((e=>{console.log("paste"),r.onIceCandidate((()=>t.innerText="Статус: создан answer")),r.setRemoteDescription(e),r.onOpen("alice",(()=>{a.navigate("game")})),r.createAnswer()})).catch(console.error)})).element;n.style.marginRight="8px";const s=new o("Copy",(()=>{const e=r.getLocalDescription();e&&navigator.clipboard.writeText(e).then((()=>{t.innerText="Статус: скопировано, ждем открытия канала"})).catch(console.error)})).element;return e.appendChild(t),e.appendChild(n),e.appendChild(s),e},"/bob":()=>{const e=document.createElement("div");e.style.padding="20px";const t=(()=>{const e=document.createElement("div");return e.style.padding="8px",e.style.fontSize="22px",e.innerText="Статус:",e})();(e=>{r.onOpen("bob",(()=>{a.navigate("game")})),r.onIceCandidate((()=>{e.innerText="Статус: создан offer"}))})(t),r.createOffer();const n=new o("Copy",(()=>{const e=r.getLocalDescription();e&&navigator.clipboard.writeText(e).then((()=>{console.log("copied"),t.innerText="Статус: скопировано, ожидаем answer"})).catch(console.error)})).element;n.style.marginRight="8px";const s=new o("Paste",(()=>{navigator.clipboard.readText().then((e=>{console.log("paste"),r.setRemoteDescription(e)})).catch(console.error)})).element;return e.appendChild(t),e.appendChild(n),e.appendChild(s),e},"/connect":()=>{const e=document.createElement("div"),t=[new o("Bob",(()=>{a.navigate("bob")})).element,new o("Alice",(()=>{a.navigate("alice")})).element,new o("←",(()=>{a.navigate("")})).element];return e.appendChild(c("Choose the role",t)),e},"/game":()=>{const e=document.createElement("div"),t=document.createElement("form");t.style.display="flex",t.style.justifyContent="center",t.style.padding="20px",t.onsubmit=e=>e.preventDefault();const n=document.createElement("div");n.style.padding="0 16px",r.dataChannel&&(r.dataChannel.onmessage=e=>{const t=l(e.data);t.style.color="grey",n.prepend(t)});const a=(new s).element,i=new o("Send",(()=>{if(a.value){const e=l(a.value);n.prepend(e),r.dataChannel&&r.dataChannel.send(a.value),a.value=""}})).element;return t.appendChild(a),t.appendChild(i),e.appendChild(t),e.appendChild(n),e}})})()})();
//# sourceMappingURL=app.a70d717da69a18b7c11d.js.map