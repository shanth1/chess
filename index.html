<!doctype html><html><head><link rel="icon" type="image/x-icon" href="assets/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="assets/favicon-48x48.png"><link rel="manifest" href="assets/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#fff"><meta name="application-name" content="microservices_template"><link rel="apple-touch-icon" sizes="57x57" href="assets/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="assets/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="assets/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="assets/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="assets/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="assets/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="assets/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="assets/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="assets/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="assets/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="microservices_template"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="assets/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="assets/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="assets/apple-touch-startup-image-1170x2532.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="assets/apple-touch-startup-image-2532x1170.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="assets/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="assets/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="assets/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="assets/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="assets/apple-touch-startup-image-1284x2778.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="assets/apple-touch-startup-image-2778x1284.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-2160x1620.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="assets/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="assets/apple-touch-startup-image-2732x2048.png"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="assets/mstile-144x144.png"><meta name="msapplication-config" content="assets/browserconfig.xml"><link rel="yandex-tableau-widget" href="assets/yandex-browser-manifest.json"><script defer="defer" src="app.f872286de38988accade.js"></script><link href="css/app.3a90ef6c5119d60a289c.css" rel="stylesheet"><meta name="theme-color" content="#ffffff" /><link rel="manifest" href="./manifest.json" /></head><head><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Chess</title><body><div id="root"></div><h3>Create or join a room?</h3><button id="createBtn">BOB: Create</button> <button id="joinBtn">ALICE: Join</button><hr><h3 id="myModalLabel">BOB: Send your local offer to ALICE</h3><input id="localOffer" rows="10" cols="50"><br><h3>Then, paste the "answer" you received</h3><input id="remoteAnswer" rows="10" cols="50"><br><br><button id="answerRecdBtn">Okay, I pasted it.</button><hr><h3>ALICE: Paste the "offer" you received</h3><input id="remoteOffer" rows="10" cols="50"><br><br><button id="offerRecdBtn">Okay, I pasted it.</button><h3>Then, send your local answer to BOB</h3><input id="localAnswer" rows="10" cols="50"><hr>Chat:<br><div id="chatlog" style="height:200px; overflow:auto; border:1px solid"></div><br><input id="messageTextBox" placeholder="Type your message here"> <button id="sendMessageBtn" onclick="sendMessage()">Send message</button><script>localOffer.value = remoteAnswer.value = remoteOffer.value = localAnswer.value = "";
    
    // BOB: create
    createBtn.onclick = function() {
        dc1 = pc1.createDataChannel('test', {reliable: true})
        activedc = dc1
        dc1.onopen = function(e) { }
        dc1.onmessage = function(e) {
        if (e.data.size) {
            fileReceiver1.receive(e.data, {})
        } else {
            if (e.data.charCodeAt(0) == 2) {
            return
            }
            var data = JSON.parse(e.data)
            if (data.type === 'file') {
            fileReceiver1.receive(e.data, {})
            } else {
            chatlog.innerHTML += '[' + new Date() + '] ' + data.message + '</p>';
            chatlog.scrollTop = chatlog.scrollHeight
            }
        }
        }
        pc1.createOffer(function(desc) {
        pc1.setLocalDescription(desc, function() {}, function() {})
        }, function() { }, sdpConstraints)
    };
    
    // BOB: pasted Alice's answer
    answerRecdBtn.onclick = function () {
        var answer = remoteAnswer.value;
        var answerDesc = new RTCSessionDescription(JSON.parse(answer))
        pc1.setRemoteDescription(answerDesc);
    };
    
    // ALICE: pasted Bob's answer
    offerRecdBtn.onclick = function() {
        var offer = remoteOffer.value;
        var offerDesc = new RTCSessionDescription(JSON.parse(offer))
        pc2.setRemoteDescription(offerDesc)
        pc2.createAnswer(function(answerDesc) {
        pc2.setLocalDescription(answerDesc)
        },
        function () { },
        sdpConstraints)
    };
    
    if (navigator.webkitGetUserMedia) {
        RTCPeerConnection = webkitRTCPeerConnection
    }
    
    var cfg = {'iceServers': [{'url': "stun:stun.gmx.net"}]},
    con = { 'optional': [{'DtlsSrtpKeyAgreement': true}] }
    
    var pc1 = new RTCPeerConnection(cfg, con), dc1 = null, tn1 = null, activedc, pc1icedone = false;
    
    var sdpConstraints = {
        optional: [],
    }
    
    function sendMessage () {
        if (messageTextBox.value) {
        activedc.send(JSON.stringify({message: messageTextBox.value}));
        chatlog.innerHTML += '[' + new Date() + '] ' + messageTextBox.value + '</p>';
        messageTextBox.value = "";
        }
        return false
    }
    
    pc1.onicecandidate = function (e) {
        if (e.candidate == null) {
        localOffer.value = JSON.stringify(pc1.localDescription);
        }
    }
    
    var pc2 = new RTCPeerConnection(cfg, con), dc2 = null, pc2icedone = false;
    
    pc2.ondatachannel = function (e) {
        var datachannel = e.channel || e;
        dc2 = datachannel
        activedc = dc2
        dc2.onopen = function (e) { }
        dc2.onmessage = function (e) {
        if (e.data.size) {
            fileReceiver2.receive(e.data, {})
        } else {
            var data = JSON.parse(e.data)
            if (data.type === 'file') {
            fileReceiver2.receive(e.data, {})
            } else {
            chatlog.innerHTML += '[' + new Date() + '] ' + data.message + '</p>';
            chatlog.scrollTop = chatlog.scrollHeight;
            }
        }
        }
    }
    
    pc2.onicecandidate = function (e) {
        if (e.candidate == null) {
        localAnswer.value = JSON.stringify(pc2.localDescription);
        }
    }</script></body></head></html>